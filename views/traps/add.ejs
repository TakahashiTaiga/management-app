<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta http-equiv="content-type"
        content="text/html; charset=UTF-8">
    <meta name="viewport" 
        content="width=device-eidth,initial-scale=1.0">
    <title>新しいわなを登録</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        /*** for mobile ~ 1023px ***/
        @media screen and (max-width:959px) {
            #side_bar {
              display: none;
            }
  
            .test {
              color: aliceblue;
            }
          
            /*** side bar ***/
            #navigation {
              position: fixed;
              top: 0;
              left: 0;
          
              z-index: 100;
  
              width: 100vw;
              height: 60px;
            }
            .navigation{
              border-bottom: 1px solid rgba(0, 0, 0, 0.4);
              background-color: white;
            }
            
            .inner_elements {
              margin: 15px;
            }
  
            .font_inner_elements {
              font-size: 18px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
            
            /*** contents ***/
            /*  */
            #contents_main {
              padding-top: 80px;
              padding-left: 5vw;
              padding-right: 5vw;
            }
            /*  */
            /*
            .contents_header {
              display: flex;
              flex-direction: row;
              flex-wrap: wrap;
              justify-content: flex-start;
              align-items: center;
            }
            */
            /*  */
            .contents_title {
              padding-top: 15px;
              padding-right: 3vw;
            }
            /*  */
            .contents_title_font {
              font-size: 28px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            .contents_account {
              padding-top: 10px;
            }
          
            .contents_account_font {
              font-size: 18px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            /*** contents table ***/
            .contents_table {
              padding-top: 3vh;
            }
          
            .contents_table_column_font {
              font-size: 15px;
              text-decoration: none;
            }
          
          
            /*** contents column ***/
            .contents_column_label {
              padding-top: 10px;
          
              font-size: 15px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
              
            }
          
            .contents_column_data {
              padding-top: 10px;
              padding-left: 15px;
              
              font-size: 15px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            /*** contents map & memo ***/
            /*
            .contents_map_and_memo {
              display: flex;
              flex-direction: row;
              flex-wrap: wrap;
              justify-content: flex-start;
              align-items: center;
          
            }
            */
          
            .contents_map {
              padding-top: 10px;
            }
          
            .contents_map_label {
              padding-top: 10px;
          
              font-size: 15px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            .contents_map_figure {
              width: 90vw;
              height: 200px;
              background-color: gray;
            }
          
            .contents_memo {
              padding-top: 10px;
            }
          
            .contents_memo_label {
              padding-top: 10px;
          
              font-size: 15px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            .contents_memo_para {
              width: 90vw;
              height: 200px;
            }
          
            /*** contents foot btns ***/
            .contents_foot_btns {
              display: -webkit-flex;
              display: flex;
              -webkit-justify-content: space-between;
              justify-content: space-between;
  
              margin-top: 60px;
              margin-bottom: 30px;
            }
  
            .contents_foot_btn {
              padding-top: 10px;
            }
          
            /*** login form ***/
            .login_form {
              margin: auto;
              margin-top: 50px;
              padding: 30px;
              padding-bottom: 50px;
              width: 350px;
          
              border: 1px solid rgba(0, 0, 0, 0.4);
              border-radius: 25px;
            }
          
            .form_contents{
              margin-top: 40px;
            }
          
            .inner_form {
              margin-bottom: 20px;
            }
          
            .form_elements {
              margin-bottom: 10px;
            }
          
            .form_font {
              font-size: 20px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            .form_btn {
              margin-top: 10px;
            }
          
            .login_btn_font {
              text-decoration: none;
            }
          
            .form_message_font {
              font-size: 12px;
              text-decoration: none;
              color: rgba(0, 0, 0, 0.7);
            }
          
            .form_message {
              margin-bottom: 20px;
            }
          }
          /*** for pc 1024px ~ ***/
          @media screen and (min-width:960px) {
          #navigation {
            display: none;
          }
  
          /*** side bar ***/
          #side_bar {
            position: fixed;
            top: 0;
            left: 0;
  
            width: 20vw;
            height: 100vh;
            
            border-right: 1px solid rgba(0, 0, 0, 0.4);
          }
  
          .inner_bar {
            margin: 3vw;
            margin-top: 5vw;
          }
  
          .elements_bar {
            margin-top: 2.5vw;
          }
  
          .font_elements_bar {
            font-size: 24px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .font_elements_bar:hover {
            color: rgba(0, 0, 0, 0.3);
          }
  
          .active_element {
            background-color: rgba(0, 0, 0, 0.1);
          }
  
          /*** contents ***/
          /*  */
          #contents_main {
            position: absolute;
            left: 20vw;
  
            width: 80vw;
  
            padding: 5vw;
          }
          /*  */
          .contents_header {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
  
            width: 70vw;
          }
          /*  */
          .contents_title {
            padding-top: 15px;
            padding-right: 3vw;
          }
          /*  */
          .contents_title_font {
            font-size: 28px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .contents_account {
            margin-right: auto;
            padding-top: 2vh;
          }
  
          .contents_account_font {
            font-size: 18px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          /*** contents table ***/
          .contents_table {
            padding-top: 3vh;
          }
  
          .contents_table_column_font {
            font-size: 15px;
            text-decoration: none;
          }
  
  
          /*** contents column ***/
          .contents_column_label {
            padding-top: 30px;
  
            font-size: 20x;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .contents_column_data {
            padding-top: 30px;
            padding-left: 50px;
            
            font-size: 20px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          /*** contents map & memo ***/
          .contents_map_and_memo {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
  
            width: 70vw;
          }
  
          .contents_map {
            padding-top: 30px;
          }
  
          .contents_map_label {
            padding-bottom: 2vh;
  
            font-size: 20px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          #mapid{
            width: 30vw;
            height: 30vh;
            background-color: gray;
          }
  
          .contents_memo {
            padding-left: 50px;
          }
  
          .contents_memo_label {
            padding-bottom: 2vh;
  
            font-size: 20px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .contents_memo_para {
            width: 30vw;
            height: 30vh;
          }
  
          /*** contents foot btns ***/
          .contents_foot_btns {
            display: -webkit-flex;
            display: flex;
            -webkit-justify-content: space-between;
            justify-content: space-between;
  
            width: 70vw;
          }
  
          .contents_foot_btn {
            padding-top: 1vh;
          }
  
          /*** login form ***/
          .login_form {
            margin: auto;
            margin-top: 10vh;
            padding: 3vw;
            padding-bottom: 10vh;
            width: 40vw;
  
            border: 1px solid rgba(0, 0, 0, 0.4);
            border-radius: 25px;
          }
  
          .form_contents{
            margin-top: 60px;
          }
  
          .inner_form {
            margin-bottom: 30px;
          }
  
          .form_elements {
            margin-bottom: 10px;
          }
  
          .form_font {
            font-size: 24px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .form_btn {
            margin-top: 10px;
          }
  
          .login_btn_font {
            text-decoration: none;
          }
  
          .form_message_font {
            font-size: 18px;
            text-decoration: none;
            color: rgba(0, 0, 0, 0.7);
          }
  
          .form_message {
            margin-bottom: 20px;
          }
        }
  
      </style> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="anonymous">
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin="anonymous"></script>
    <!-- plugin -->
    <link rel="stylesheet" href="/stylesheets/Control.FullScreen.css">
    <script src="/javascripts/Control.FullScreen.js"></script>
    <!-- plugin -->

  </head>

<body>

    <%- include('../side_bar', {val:1}) %>
    <%- include('../navigation', {val:1}) %>


    <div id="contents_main">
        <form method="post" action="/management-app/traps/add">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="contents_header">
            <div class="contents_title"><p class="contents_title_font">新しいわなを登録</p></div>
            </div>
    
            <div>
            <table>
                <tbody>
                    <tr>
                        <th class="contents_column_label">名前</th>
                        <td class="contents_column_data">
                            <div class="mb-3">
                            <input type="text" class="form-control" name="name" id="name">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="contents_column_label">子機番号</th>
                        <td class="contents_column_data">
                            <div class="mb-3">
                            <input type="text" class="form-control" name="extension_unit_id" id="extension_unit_id">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            </div>
    
            <div class="contents_map_and_memo">
                <div class="contents_map">
                    <p class="contents_map_label">位置情報</p>
                    <div id="mapid" class="contents_map_figure"></div>
                    <input type="hidden" name="lat" id="lat" value="none">
                    <input type="hidden" name="lng" id="lng" value="none">
 
 
                    <script>
                        var mk;
                        var map = new L.Map('mapid', {
                            fullscreenControl: true,
                            fullscreenControlOptions: {
                            position: 'topleft',
                            title: 'フルスクリーン表示',
                            titleCancel: '通常表示に戻す',
                            forceSeparateButton: true
                            }
                        });
                        navigator.geolocation.getCurrentPosition((position)=>{   
                            let coords = position.coords;
                            let mpoint = [coords.latitude, coords.longitude];
                            //デフォルトの位置情報（現在地）を表示
                            map.setView(mpoint, 15);
                            //デフォルトのマーカーを表示
                            mk = L.marker(mpoint,{title:"trap"}).addTo(map);
                            console.log(mk._latlng);
                            document.getElementById("lat").value = mk._latlng.lat;
                            document.getElementById("lng").value = mk._latlng.lng;
                        });
                        /*
                        //デフォルトの位置情報を表示
                        mpoint = 
                        map.setView(mpoint, 15);
                        //デフォルトのマーカーを表示
                        mk = L.marker(mpoint,{title:"trap"}).addTo(map);
                        */
                    
                        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                            maxZoom: 18,
                            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '
                            }).addTo(map);
                        //地図のclickイベントでonMapClick関数を呼び出し
                        map.on('click', onMapClick);
                    
                        function onMapClick(e) {
                            // 地図のclickイベント呼び出される
                            map.removeLayer(mk);
                            // クリック地点の座標にマーカーを追加、マーカーのclickイベントでonMarkerClick関数を呼び出し
                            mk = L.marker(e.latlng).on('click', onMarkerClick).addTo(map);
                            // mk._latlngにクリックしたところの緯度経度が入っている。
                            console.log(mk._latlng);
                            document.getElementById("lat").value = mk._latlng.lat;
                            document.getElementById("lng").value = mk._latlng.lng;
                        }
                        function onMarkerClick(e) {
                            // マーカーのclickイベント呼び出される
                            // クリックされたマーカーを地図のレイヤから削除する
                            map.removeLayer(e.target);
                        }
                    </script>
                </div>    
        
                <div class="contents_memo">
                    <p class="contents_memo_label">メモ</p>
                    <div class="contents_memo_para">
                        <div class="mb-3">
                        <textarea class="form-control" id="exampleFormControlTextarea1" name="memo" rows="10"></textarea>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="contents_foot_btns">
                <div class="contents_foot_btn"><button type="button" class="btn btn-outline-primary">位置情報を登録</button></div>
                <div class="contents_foot_btn"><input type="submit" value="新規登録" class="btn btn-primary"></a></div>
            </div>      
        </form>
    </div>  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>

</html>